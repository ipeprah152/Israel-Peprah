<html class="scroll-smooth" lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   ST. Augustine’s School
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f3f4f6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    /* Scrollbar for desktop */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background-color: #3b82f6;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-track {
      background: #e5e7eb;
    }
  </style>
 </head>
 <body class="flex flex-col min-h-screen">
  <!-- Main container for SPA -->
  <div class="flex-grow flex flex-col" id="app">
   <!-- Home / Landing Page -->
   <section class="flex flex-col justify-center items-center flex-grow bg-gradient-to-tr from-blue-50 to-white px-6 text-center" id="home">
    <h1 class="text-5xl sm:text-6xl font-extrabold text-blue-700 select-none drop-shadow-lg mb-12">
     ST. Augustine’s School
    </h1>
    <div class="flex flex-col sm:flex-row gap-6">
     <button class="px-10 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-lg font-semibold shadow-lg transition duration-300 flex items-center justify-center gap-3" data-role="login">
      <i class="fas fa-sign-in-alt">
      </i>
      Log In
     </button>
     <button class="px-10 py-4 bg-green-600 hover:bg-green-700 text-white rounded-lg text-lg font-semibold shadow-lg transition duration-300 flex items-center justify-center gap-3" data-role="signup">
      <i class="fas fa-user-plus">
      </i>
      Sign Up
     </button>
    </div>
   </section>
   <!-- Role Selection Modal for Login/Signup -->
   <section class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 px-4" id="role-selection">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8">
     <h2 class="text-2xl font-bold text-center mb-6">
      Select Your Role
     </h2>
     <div class="flex flex-col gap-4">
      <button class="role-btn bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold transition duration-300" data-role="administrator">
       Administrator
      </button>
      <button class="role-btn bg-yellow-600 hover:bg-yellow-700 text-white py-3 rounded-lg font-semibold transition duration-300" data-role="teacher">
       Teacher
      </button>
      <button class="role-btn bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition duration-300" data-role="student">
       Student
      </button>
     </div>
     <button class="mt-6 w-full text-center text-gray-600 hover:text-gray-900 font-semibold" id="role-cancel">
      Cancel
     </button>
    </div>
   </section>
   <!-- Login Form -->
   <section class="hidden flex flex-col items-center justify-center flex-grow bg-gradient-to-tr from-blue-50 to-white px-6 py-12" id="login-form">
    <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8">
     <h2 class="text-3xl font-extrabold text-center mb-8 text-blue-700">
      Log In
     </h2>
     <form class="flex flex-col gap-6" id="loginForm" novalidate="">
      <input id="loginRole" name="role" type="hidden"/>
      <div>
       <label class="block text-sm font-semibold mb-1" for="loginEmail">
        Email
       </label>
       <input class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" id="loginEmail" name="email" placeholder="you@example.com" required="" type="email"/>
      </div>
      <div>
       <label class="block text-sm font-semibold mb-1" for="loginPassword">
        Password
       </label>
       <input class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" id="loginPassword" name="password" placeholder="********" required="" type="password"/>
      </div>
      <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition duration-300 flex justify-center items-center gap-2" type="submit">
       <i class="fas fa-sign-in-alt">
       </i>
       Log In
      </button>
      <button class="mt-4 w-full text-center text-gray-600 hover:text-gray-900 font-semibold" id="loginBack" type="button">
       Back to Home
      </button>
     </form>
    </div>
   </section>
   <!-- Signup Form -->
   <section class="hidden flex flex-col items-center justify-center flex-grow bg-gradient-to-tr from-green-50 to-white px-6 py-12 overflow-auto" id="signup-form">
    <div class="bg-white rounded-3xl shadow-2xl max-w-lg w-full p-8">
     <h2 class="text-3xl font-extrabold text-center mb-8 text-green-700">
      Sign Up
     </h2>
     <form class="flex flex-col gap-6" enctype="multipart/form-data" id="signupForm" novalidate="">
      <input id="signupRole" name="role" type="hidden"/>
      <div>
       <label class="block text-sm font-semibold mb-1" for="signupFullName">
        Full Name
       </label>
       <input class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500" id="signupFullName" name="fullName" placeholder="John Doe" required="" type="text"/>
      </div>
      <div>
       <label class="block text-sm font-semibold mb-1" for="signupEmail">
        Email
       </label>
       <input class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500" id="signupEmail" name="email" placeholder="you@example.com" required="" type="email"/>
      </div>
      <div>
       <label class="block text-sm font-semibold mb-1" for="signupPassword">
        Password
       </label>
       <input class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500" id="signupPassword" name="password" placeholder="********" required="" type="password"/>
      </div>
      <div>
       <label class="block text-sm font-semibold mb-1" for="signupPhone">
        Phone Number
       </label>
       <input class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500" id="signupPhone" name="phone" placeholder="+1234567890" type="tel"/>
      </div>
      <div>
       <label class="block text-sm font-semibold mb-1" for="signupDOB">
        Date of Birth
       </label>
       <input class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500" id="signupDOB" name="dob" required="" type="date"/>
      </div>
      <div>
       <label class="block text-sm font-semibold mb-1" for="signupProfilePic">
        Profile Picture
       </label>
       <input accept="image/*" class="w-full" id="signupProfilePic" name="profilePic" required="" type="file"/>
      </div>
      <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition duration-300 flex justify-center items-center gap-2" type="submit">
       <i class="fas fa-user-plus">
       </i>
       Sign Up
      </button>
      <button class="mt-4 w-full text-center text-gray-600 hover:text-gray-900 font-semibold" id="signupBack" type="button">
       Back to Home
      </button>
     </form>
    </div>
   </section>
   <!-- Student Classroom -->
   <section class="hidden flex flex-col flex-grow bg-gradient-to-tr from-blue-50 to-white px-6 py-8 overflow-auto" id="student-classroom">
    <header class="flex justify-between items-center mb-8">
     <h2 class="text-4xl font-extrabold text-blue-700 select-none">
      Student Classroom
     </h2>
     <button class="flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition duration-300" id="studentLogout">
      <i class="fas fa-sign-out-alt">
      </i>
      Logout
     </button>
    </header>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
     <article class="bg-white rounded-2xl shadow-lg p-6 flex flex-col">
      <img alt="A colorful classroom scene showing students learning mathematics with numbers and shapes on a blackboard" class="rounded-xl mb-4 object-cover h-40 w-full" height="300" src="https://storage.googleapis.com/a1aa/image/43da3469-76fd-4a55-b759-83dd52f35dfc.jpg" width="600"/>
      <h3 class="text-xl font-bold mb-2 text-blue-800">
       Mathematics
      </h3>
      <p class="text-gray-700 flex-grow">
       Explore algebra, geometry, and calculus with interactive lessons and exercises.
      </p>
      <a class="mt-4 inline-block text-blue-600 hover:underline font-semibold" href="#">
       Go to Materials
      </a>
     </article>
     <article class="bg-white rounded-2xl shadow-lg p-6 flex flex-col">
      <img alt="A science laboratory with students conducting experiments and colorful chemical liquids in test tubes" class="rounded-xl mb-4 object-cover h-40 w-full" height="300" src="https://storage.googleapis.com/a1aa/image/6eac6e0d-ace9-4db9-cf44-82f8f54bafa1.jpg" width="600"/>
      <h3 class="text-xl font-bold mb-2 text-blue-800">
       Science
      </h3>
      <p class="text-gray-700 flex-grow">
       Discover physics, chemistry, and biology through videos, quizzes, and experiments.
      </p>
      <a class="mt-4 inline-block text-blue-600 hover:underline font-semibold" href="#">
       Go to Materials
      </a>
     </article>
     <article class="bg-white rounded-2xl shadow-lg p-6 flex flex-col">
      <img alt="A history classroom with a timeline on the wall and students discussing historical events" class="rounded-xl mb-4 object-cover h-40 w-full" height="300" src="https://storage.googleapis.com/a1aa/image/80dde25d-db7c-4904-568e-a275d035236d.jpg" width="600"/>
      <h3 class="text-xl font-bold mb-2 text-blue-800">
       History
      </h3>
      <p class="text-gray-700 flex-grow">
       Learn about world history, important events, and influential figures.
      </p>
      <a class="mt-4 inline-block text-blue-600 hover:underline font-semibold" href="#">
       Go to Materials
      </a>
     </article>
     <article class="bg-white rounded-2xl shadow-lg p-6 flex flex-col">
      <img alt="Students reading classic English literature books in a cozy classroom setting" class="rounded-xl mb-4 object-cover h-40 w-full" height="300" src="https://storage.googleapis.com/a1aa/image/4398d6c4-d997-4ae2-d263-d4f5630d8d8e.jpg" width="600"/>
      <h3 class="text-xl font-bold mb-2 text-blue-800">
       English Literature
      </h3>
      <p class="text-gray-700 flex-grow">
       Explore poetry, novels, and plays from classic and modern authors.
      </p>
      <a class="mt-4 inline-block text-blue-600 hover:underline font-semibold" href="#">
       Go to Materials
      </a>
     </article>
     <article class="bg-white rounded-2xl shadow-lg p-6 flex flex-col">
      <img alt="An art classroom with students painting and drawing colorful artworks" class="rounded-xl mb-4 object-cover h-40 w-full" height="300" src="https://storage.googleapis.com/a1aa/image/acaf696a-a373-478e-999a-428deab7409a.jpg" width="600"/>
      <h3 class="text-xl font-bold mb-2 text-blue-800">
       Art
      </h3>
      <p class="text-gray-700 flex-grow">
       Develop your creativity with drawing, painting, and sculpture tutorials.
      </p>
      <a class="mt-4 inline-block text-blue-600 hover:underline font-semibold" href="#">
       Go to Materials
      </a>
     </article>
     <article class="bg-white rounded-2xl shadow-lg p-6 flex flex-col">
      <img alt="Students playing sports and doing physical exercises in a gymnasium" class="rounded-xl mb-4 object-cover h-40 w-full" height="300" src="https://storage.googleapis.com/a1aa/image/b241b276-5d3a-4c23-839b-26ddf2543535.jpg" width="600"/>
      <h3 class="text-xl font-bold mb-2 text-blue-800">
       Physical Education
      </h3>
      <p class="text-gray-700 flex-grow">
       Stay active with sports, fitness routines, and health education.
      </p>
      <a class="mt-4 inline-block text-blue-600 hover:underline font-semibold" href="#">
       Go to Materials
      </a>
     </article>
    </div>
    <footer class="mt-12 text-center text-gray-600 font-semibold select-none">
     © 2025 Designed and published by AnGeL OnE👼
    </footer>
   </section>
   <!-- Teacher Classroom -->
   <section class="hidden flex flex-col flex-grow bg-gradient-to-tr from-yellow-50 to-white px-6 py-8 overflow-auto" id="teacher-classroom">
    <header class="flex justify-between items-center mb-8">
     <h2 class="text-4xl font-extrabold text-yellow-800 select-none">
      Teacher Classroom
     </h2>
     <button class="flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition duration-300" id="teacherLogout">
      <i class="fas fa-sign-out-alt">
      </i>
      Logout
     </button>
    </header>
    <section class="mb-8">
     <h3 class="text-2xl font-bold mb-4 text-yellow-900">
      Students Details
     </h3>
     <div class="overflow-x-auto rounded-lg shadow-lg bg-white">
      <table class="min-w-full divide-y divide-yellow-300">
       <thead class="bg-yellow-200">
        <tr>
         <th class="px-6 py-3 text-left text-xs font-semibold text-yellow-900 uppercase tracking-wider">
          Profile
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-yellow-900 uppercase tracking-wider">
          Full Name
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-yellow-900 uppercase tracking-wider">
          Email
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-yellow-900 uppercase tracking-wider">
          Phone
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-yellow-900 uppercase tracking-wider">
          Date of Birth
         </th>
        </tr>
       </thead>
       <tbody class="divide-y divide-yellow-100" id="teacherStudentTable">
        <!-- Student rows inserted by JS -->
       </tbody>
      </table>
     </div>
    </section>
    <footer class="mt-auto text-center text-gray-600 font-semibold select-none">
     © 2025 Designed and published by AnGeL OnE👼
    </footer>
   </section>
   <!-- Administrator Dashboard -->
   <section class="hidden flex flex-col flex-grow bg-gradient-to-tr from-red-50 to-white px-6 py-8 overflow-auto" id="admin-dashboard">
    <header class="flex justify-between items-center mb-8">
     <h2 class="text-4xl font-extrabold text-red-700 select-none">
      Administrator Dashboard
     </h2>
     <button class="flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition duration-300" id="adminLogout">
      <i class="fas fa-sign-out-alt">
      </i>
      Logout
     </button>
    </header>
    <section class="mb-12">
     <h3 class="text-2xl font-bold mb-4 text-red-800">
      Manage Students
     </h3>
     <button class="mb-4 bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-lg font-semibold transition duration-300 flex items-center gap-2" id="addStudentBtn">
      <i class="fas fa-user-plus">
      </i>
      Add New Student
     </button>
     <div class="overflow-x-auto rounded-lg shadow-lg bg-white">
      <table class="min-w-full divide-y divide-red-300">
       <thead class="bg-red-200">
        <tr>
         <th class="px-6 py-3 text-left text-xs font-semibold text-red-900 uppercase tracking-wider">
          Profile
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-red-900 uppercase tracking-wider">
          Full Name
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-red-900 uppercase tracking-wider">
          Email
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-red-900 uppercase tracking-wider">
          Phone
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-red-900 uppercase tracking-wider">
          Date of Birth
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-red-900 uppercase tracking-wider">
          Actions
         </th>
        </tr>
       </thead>
       <tbody class="divide-y divide-red-100" id="adminStudentTable">
        <!-- Student rows inserted by JS -->
       </tbody>
      </table>
     </div>
    </section>
    <section>
     <h3 class="text-2xl font-bold mb-4 text-red-800">
      Manage Teachers
     </h3>
     <button class="mb-4 bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-lg font-semibold transition duration-300 flex items-center gap-2" id="addTeacherBtn">
      <i class="fas fa-user-plus">
      </i>
      Add New Teacher
     </button>
     <div class="overflow-x-auto rounded-lg shadow-lg bg-white">
      <table class="min-w-full divide-y divide-red-300">
       <thead class="bg-red-200">
        <tr>
         <th class="px-6 py-3 text-left text-xs font-semibold text-red-900 uppercase tracking-wider">
          Profile
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-red-900 uppercase tracking-wider">
          Full Name
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-red-900 uppercase tracking-wider">
          Email
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-red-900 uppercase tracking-wider">
          Phone
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-red-900 uppercase tracking-wider">
          Date of Birth
         </th>
         <th class="px-6 py-3 text-left text-xs font-semibold text-red-900 uppercase tracking-wider">
          Actions
         </th>
        </tr>
       </thead>
       <tbody class="divide-y divide-red-100" id="adminTeacherTable">
        <!-- Teacher rows inserted by JS -->
       </tbody>
      </table>
     </div>
    </section>
    <!-- Add/Edit Modal -->
    <div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 hidden px-4" id="adminModal">
     <div class="bg-white rounded-3xl shadow-2xl max-w-lg w-full p-8 overflow-auto max-h-[90vh]">
      <h3 class="text-2xl font-bold mb-6 text-red-700" id="modalTitle">
      </h3>
      <form class="flex flex-col gap-6" enctype="multipart/form-data" id="adminForm" novalidate="">
       <input id="adminFormType" name="type" type="hidden"/>
       <input id="adminFormId" name="id" type="hidden"/>
       <div>
        <label class="block text-sm font-semibold mb-1" for="adminFullName">
         Full Name
        </label>
        <input class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-500" id="adminFullName" name="fullName" placeholder="John Doe" required="" type="text"/>
       </div>
       <div>
        <label class="block text-sm font-semibold mb-1" for="adminEmail">
         Email
        </label>
        <input class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-500" id="adminEmail" name="email" placeholder="you@example.com" required="" type="email"/>
       </div>
       <div>
        <label class="block text-sm font-semibold mb-1" for="adminPhone">
         Phone Number
        </label>
        <input class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-500" id="adminPhone" name="phone" placeholder="+1234567890" type="tel"/>
       </div>
       <div>
        <label class="block text-sm font-semibold mb-1" for="adminDOB">
         Date of Birth
        </label>
        <input class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-500" id="adminDOB" name="dob" required="" type="date"/>
       </div>
       <div>
        <label class="block text-sm font-semibold mb-1" for="adminProfilePic">
         Profile Picture
        </label>
        <input accept="image/*" class="w-full" id="adminProfilePic" name="profilePic" type="file"/>
        <p class="text-xs text-gray-500 mt-1">
         Leave empty to keep current picture
        </p>
       </div>
       <div class="flex justify-end gap-4 mt-6">
        <button class="px-6 py-3 rounded-lg border border-red-600 text-red-600 font-semibold hover:bg-red-50 transition duration-300" id="adminCancelBtn" type="button">
         Cancel
        </button>
        <button class="px-6 py-3 rounded-lg bg-red-600 hover:bg-red-700 text-white font-semibold transition duration-300" type="submit">
         Save
        </button>
       </div>
      </form>
     </div>
    </div>
    <footer class="mt-auto text-center text-gray-600 font-semibold select-none">
     © 2025 Designed and published by AnGeL OnE👼
    </footer>
   </section>
  </div>
  <script>
   // Data storage keys
    const STORAGE_KEYS = {
      students: 'st_asc_students',
      teachers: 'st_asc_teachers',
      admins: 'st_asc_admins',
      sessions: 'st_asc_sessions',
    };

    // Initialize data if not present
    function initData() {
      if (!localStorage.getItem(STORAGE_KEYS.students)) {
        localStorage.setItem(STORAGE_KEYS.students, JSON.stringify([]));
      }
      if (!localStorage.getItem(STORAGE_KEYS.teachers)) {
        localStorage.setItem(STORAGE_KEYS.teachers, JSON.stringify([]));
      }
      if (!localStorage.getItem(STORAGE_KEYS.admins)) {
        // Create default admin account
        const defaultAdmins = [
          {
            id: crypto.randomUUID(),
            fullName: 'Default Admin',
            email: 'admin@staugustine.edu',
            password: 'admin123',
            phone: '',
            dob: '',
            profilePic: '',
          },
        ];
        localStorage.setItem(STORAGE_KEYS.admins, JSON.stringify(defaultAdmins));
      }
      if (!localStorage.getItem(STORAGE_KEYS.sessions)) {
        localStorage.setItem(STORAGE_KEYS.sessions, JSON.stringify({}));
      }
    }

    // Utility: read data from localStorage
    function readData(key) {
      return JSON.parse(localStorage.getItem(key)) || [];
    }

    // Utility: write data to localStorage
    function writeData(key, data) {
      localStorage.setItem(key, JSON.stringify(data));
    }

    // Utility: read sessions
    function readSessions() {
      return JSON.parse(localStorage.getItem(STORAGE_KEYS.sessions)) || {};
    }

    // Utility: write sessions
    function writeSessions(sessions) {
      localStorage.setItem(STORAGE_KEYS.sessions, JSON.stringify(sessions));
    }

    // Utility: get current session user
    function getCurrentUser() {
      const sessions = readSessions();
      return sessions.currentUser || null;
    }

    // Utility: set current session user
    function setCurrentUser(user) {
      const sessions = readSessions();
      sessions.currentUser = user;
      writeSessions(sessions);
    }

    // Utility: clear current session user
    function clearCurrentUser() {
      const sessions = readSessions();
      delete sessions.currentUser;
      writeSessions(sessions);
    }

    // Show only one section by id
    function showSection(id) {
      const sections = [
        'home',
        'role-selection',
        'login-form',
        'signup-form',
        'student-classroom',
        'teacher-classroom',
        'admin-dashboard',
      ];
      sections.forEach((sec) => {
        document.getElementById(sec).classList.add('hidden');
      });
      document.getElementById(id).classList.remove('hidden');
      window.scrollTo(0, 0);
    }

    // Show role selection modal for login or signup
    function openRoleSelection(action) {
      const roleSelection = document.getElementById('role-selection');
      roleSelection.dataset.action = action;
      roleSelection.classList.remove('hidden');
    }

    // Close role selection modal
    function closeRoleSelection() {
      const roleSelection = document.getElementById('role-selection');
      roleSelection.classList.add('hidden');
      delete roleSelection.dataset.action;
    }

    // Set role for login or signup and show corresponding form
    function setRoleAndShowForm(role, action) {
      closeRoleSelection();
      if (action === 'login') {
        document.getElementById('loginRole').value = role;
        document.getElementById('loginForm').reset();
        showSection('login-form');
      } else if (action === 'signup') {
        document.getElementById('signupRole').value = role;
        document.getElementById('signupForm').reset();
        showSection('signup-form');
      }
    }

    // Validate email format
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email.toLowerCase());
    }

    // Validate phone number (basic)
    function validatePhone(phone) {
      if (!phone) return true; // optional
      const re = /^\+?[0-9\s\-]{7,15}$/;
      return re.test(phone);
    }

    // Read file as base64 string
    function readFileAsDataURL(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = () => reject(new Error('File reading error'));
        reader.readAsDataURL(file);
      });
    }

    // Login form submit handler
    async function handleLoginSubmit(e) {
      e.preventDefault();
      const role = e.target.role.value;
      const email = e.target.email.value.trim().toLowerCase();
      const password = e.target.password.value;

      if (!validateEmail(email)) {
        alert('Please enter a valid email address.');
        return;
      }
      if (!password) {
        alert('Please enter your password.');
        return;
      }

      let users = [];
      if (role === 'student') users = readData(STORAGE_KEYS.students);
      else if (role === 'teacher') users = readData(STORAGE_KEYS.teachers);
      else if (role === 'administrator') users = readData(STORAGE_KEYS.admins);
      else {
        alert('Invalid role selected.');
        return;
      }

      const user = users.find(
        (u) => u.email.toLowerCase() === email && u.password === password
      );
      if (!user) {
        alert('Invalid email or password.');
        return;
      }

      setCurrentUser({ ...user, role });
      if (role === 'student') {
        showStudentClassroom();
      } else if (role === 'teacher') {
        showTeacherClassroom();
      } else if (role === 'administrator') {
        showAdminDashboard();
      }
    }

    // Signup form submit handler
    async function handleSignupSubmit(e) {
      e.preventDefault();
      const role = e.target.role.value;
      const fullName = e.target.fullName.value.trim();
      const email = e.target.email.value.trim().toLowerCase();
      const password = e.target.password.value;
      const phone = e.target.phone.value.trim();
      const dob = e.target.dob.value;
      const profilePicFile = e.target.profilePic.files[0];

      if (!fullName) {
        alert('Please enter your full name.');
        return;
      }
      if (!validateEmail(email)) {
        alert('Please enter a valid email address.');
        return;
      }
      if (!password) {
        alert('Please enter a password.');
        return;
      }
      if (!dob) {
        alert('Please enter your date of birth.');
        return;
      }
      if (!profilePicFile) {
        alert('Please upload a profile picture.');
        return;
      }
      if (!validatePhone(phone)) {
        alert('Please enter a valid phone number.');
        return;
      }

      let users = [];
      let storageKey = '';
      if (role === 'student') storageKey = STORAGE_KEYS.students;
      else if (role === 'teacher') storageKey = STORAGE_KEYS.teachers;
      else if (role === 'administrator') storageKey = STORAGE_KEYS.admins;
      else {
        alert('Invalid role selected.');
        return;
      }
      users = readData(storageKey);

      // Check if email already exists
      if (users.some((u) => u.email.toLowerCase() === email)) {
        alert('Email already registered.');
        return;
      }

      const profilePic = await readFileAsDataURL(profilePicFile);

      const newUser = {
        id: crypto.randomUUID(),
        fullName,
        email,
        password,
        phone,
        dob,
        profilePic,
      };

      users.push(newUser);
      writeData(storageKey, users);
      alert('Registration successful! You can now log in.');
      showSection('home');
    }

    // Show student classroom
    function showStudentClassroom() {
      showSection('student-classroom');
    }

    // Show teacher classroom
    function showTeacherClassroom() {
      populateTeacherStudentTable();
      showSection('teacher-classroom');
    }

    // Show admin dashboard
    function showAdminDashboard() {
      populateAdminTables();
      showSection('admin-dashboard');
    }

    // Populate teacher student table (read-only)
    function populateTeacherStudentTable() {
      const tbody = document.getElementById('teacherStudentTable');
      tbody.innerHTML = '';
      const students = readData(STORAGE_KEYS.students);
      if (students.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 5;
        td.className = 'px-6 py-4 text-center text-yellow-700 font-semibold';
        td.textContent = 'No students found.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }
      students.forEach((student) => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-yellow-50 cursor-default';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap">
            <img src="${student.profilePic}" alt="Profile picture of student ${student.fullName}" class="h-10 w-10 rounded-full object-cover" />
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-yellow-900 font-semibold">${student.fullName}</td>
          <td class="px-6 py-4 whitespace-nowrap text-yellow-900">${student.email}</td>
          <td class="px-6 py-4 whitespace-nowrap text-yellow-900">${student.phone || '-'}</td>
          <td class="px-6 py-4 whitespace-nowrap text-yellow-900">${student.dob}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Populate admin tables for students and teachers
    function populateAdminTables() {
      const studentTbody = document.getElementById('adminStudentTable');
      const teacherTbody = document.getElementById('adminTeacherTable');
      studentTbody.innerHTML = '';
      teacherTbody.innerHTML = '';

      const students = readData(STORAGE_KEYS.students);
      const teachers = readData(STORAGE_KEYS.teachers);

      if (students.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 6;
        td.className = 'px-6 py-4 text-center text-red-700 font-semibold';
        td.textContent = 'No students found.';
        tr.appendChild(td);
        studentTbody.appendChild(tr);
      } else {
        students.forEach((student) => {
          const tr = document.createElement('tr');
          tr.className = 'hover:bg-red-50';
          tr.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap">
              <img src="${student.profilePic}" alt="Profile picture of student ${student.fullName}" class="h-10 w-10 rounded-full object-cover" />
            </td>
            <td class="px-6 py-4 whitespace-nowrap font-semibold text-red-900">${student.fullName}</td>
            <td class="px-6 py-4 whitespace-nowrap text-red-900">${student.email}</td>
            <td class="px-6 py-4 whitespace-nowrap text-red-900">${student.phone || '-'}</td>
            <td class="px-6 py-4 whitespace-nowrap text-red-900">${student.dob}</td>
            <td class="px-6 py-4 whitespace-nowrap text-red-900">
              <button data-type="student" data-id="${student.id}" class="edit-btn mr-2 text-yellow-600 hover:text-yellow-800" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button data-type="student" data-id="${student.id}" class="delete-btn text-red-600 hover:text-red-800" title="Delete">
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          `;
          studentTbody.appendChild(tr);
        });
      }

      if (teachers.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 6;
        td.className = 'px-6 py-4 text-center text-red-700 font-semibold';
        td.textContent = 'No teachers found.';
        tr.appendChild(td);
        teacherTbody.appendChild(tr);
      } else {
        teachers.forEach((teacher) => {
          const tr = document.createElement('tr');
          tr.className = 'hover:bg-red-50';
          tr.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap">
              <img src="${teacher.profilePic}" alt="Profile picture of teacher ${teacher.fullName}" class="h-10 w-10 rounded-full object-cover" />
            </td>
            <td class="px-6 py-4 whitespace-nowrap font-semibold text-red-900">${teacher.fullName}</td>
            <td class="px-6 py-4 whitespace-nowrap text-red-900">${teacher.email}</td>
            <td class="px-6 py-4 whitespace-nowrap text-red-900">${teacher.phone || '-'}</td>
            <td class="px-6 py-4 whitespace-nowrap text-red-900">${teacher.dob}</td>
            <td class="px-6 py-4 whitespace-nowrap text-red-900">
              <button data-type="teacher" data-id="${teacher.id}" class="edit-btn mr-2 text-yellow-600 hover:text-yellow-800" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button data-type="teacher" data-id="${teacher.id}" class="delete-btn text-red-600 hover:text-red-800" title="Delete">
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          `;
          teacherTbody.appendChild(tr);
        });
      }
    }

    // Open admin modal for add or edit
    async function openAdminModal(type, mode, id = null) {
      const modal = document.getElementById('adminModal');
      const modalTitle = document.getElementById('modalTitle');
      const form = document.getElementById('adminForm');

      form.reset();
      form.profilePic.value = '';

      document.getElementById('adminFormType').value = type;
      document.getElementById('adminFormId').value = id || '';

      if (mode === 'add') {
        modalTitle.textContent = `Add New ${capitalize(type)}`;
      } else if (mode === 'edit') {
        modalTitle.textContent = `Edit ${capitalize(type)}`;
        // Load data for editing
        let users = [];
        if (type === 'student') users = readData(STORAGE_KEYS.students);
        else if (type === 'teacher') users = readData(STORAGE_KEYS.teachers);
        else return;

        const user = users.find((u) => u.id === id);
        if (!user) return;

        document.getElementById('adminFullName').value = user.fullName;
        document.getElementById('adminEmail').value = user.email;
        document.getElementById('adminPhone').value = user.phone || '';
        document.getElementById('adminDOB').value = user.dob;
      }

      modal.classList.remove('hidden');
      window.scrollTo(0, 0);
    }

    // Close admin modal
    function closeAdminModal() {
      const modal = document.getElementById('adminModal');
      modal.classList.add('hidden');
    }

    // Capitalize first letter
    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // Admin form submit handler
    async function handleAdminFormSubmit(e) {
      e.preventDefault();
      const type = e.target.type.value;
      const id = e.target.id.value;
      const fullName = e.target.fullName.value.trim();
      const email = e.target.email.value.trim().toLowerCase();
      const phone = e.target.phone.value.trim();
      const dob = e.target.dob.value;
      const profilePicFile = e.target.profilePic.files[0];

      if (!fullName) {
        alert('Please enter full name.');
        return;
      }
      if (!validateEmail(email)) {
        alert('Please enter a valid email address.');
        return;
      }
      if (!dob) {
        alert('Please enter date of birth.');
        return;
      }
      if (!validatePhone(phone)) {
        alert('Please enter a valid phone number.');
        return;
      }

      let users = [];
      let storageKey = '';
      if (type === 'student') storageKey = STORAGE_KEYS.students;
      else if (type === 'teacher') storageKey = STORAGE_KEYS.teachers;
      else return;

      users = readData(storageKey);

      // Check for email uniqueness except current user
      if (
        users.some(
          (u) => u.email.toLowerCase() === email && (id === '' || u.id !== id)
        )
      ) {
        alert('Email already registered.');
        return;
      }

      let profilePic = null;
      if (profilePicFile) {
        profilePic = await readFileAsDataURL(profilePicFile);
      }

      if (id) {
        // Edit existing
        const idx = users.findIndex((u) => u.id === id);
        if (idx === -1) {
          alert('User not found.');
          return;
        }
        users[idx].fullName = fullName;
        users[idx].email = email;
        users[idx].phone = phone;
        users[idx].dob = dob;
        if (profilePic) users[idx].profilePic = profilePic;
      } else {
        // Add new
        const newUser = {
          id: crypto.randomUUID(),
          fullName,
          email,
          password: 'default123', // default password for admin added users
          phone,
          dob,
          profilePic: profilePic || '',
        };
        users.push(newUser);
      }

      writeData(storageKey, users);
      populateAdminTables();
      closeAdminModal();
    }

    // Delete user by id and type
    function deleteUser(type, id) {
      if (!confirm('Are you sure you want to delete this user?')) return;
      let users = [];
      let storageKey = '';
      if (type === 'student') storageKey = STORAGE_KEYS.students;
      else if (type === 'teacher') storageKey = STORAGE_KEYS.teachers;
      else return;

      users = readData(storageKey);
      users = users.filter((u) => u.id !== id);
      writeData(storageKey, users);
      populateAdminTables();
    }

    // Logout handler
    function logout() {
      clearCurrentUser();
      showSection('home');
    }

    // On page load
    document.addEventListener('DOMContentLoaded', () => {
      initData();

      // Check if user is logged in
      const currentUser = getCurrentUser();
      if (currentUser) {
        if (currentUser.role === 'student') showStudentClassroom();
        else if (currentUser.role === 'teacher') showTeacherClassroom();
        else if (currentUser.role === 'administrator') showAdminDashboard();
        else showSection('home');
      } else {
        showSection('home');
      }

      // Home buttons
      document.querySelector('button[data-role="login"]').addEventListener('click', () => openRoleSelection('login'));
      document.querySelector('button[data-role="signup"]').addEventListener('click', () => openRoleSelection('signup'));

      // Role selection buttons
      document.querySelectorAll('.role-btn').forEach((btn) => {
        btn.addEventListener('click', (e) => {
          const role = e.currentTarget.dataset.role || e.currentTarget.getAttribute('data-role');
          const action = document.getElementById('role-selection').dataset.action;
          setRoleAndShowForm(role, action);
        });
      });

      // Cancel role selection
      document.getElementById('role-cancel').addEventListener('click', () => {
        closeRoleSelection();
      });

      // Login back button
      document.getElementById('loginBack').addEventListener('click', () => {
        showSection('home');
      });

      // Signup back button
      document.getElementById('signupBack').addEventListener('click', () => {
        showSection('home');
      });

      // Login form submit
      document.getElementById('loginForm').addEventListener('submit', handleLoginSubmit);

      // Signup form submit
      document.getElementById('signupForm').addEventListener('submit', handleSignupSubmit);

      // Logout buttons
      document.getElementById('studentLogout').addEventListener('click', logout);
      document.getElementById('teacherLogout').addEventListener('click', logout);
      document.getElementById('adminLogout').addEventListener('click', logout);

      // Admin add buttons
      document.getElementById('addStudentBtn').addEventListener('click', () => openAdminModal('student', 'add'));
      document.getElementById('addTeacherBtn').addEventListener('click', () => openAdminModal('teacher', 'add'));

      // Admin cancel modal
      document.getElementById('adminCancelBtn').addEventListener('click', closeAdminModal);

      // Admin form submit
      document.getElementById('adminForm').addEventListener('submit', handleAdminFormSubmit);

      // Delegate edit and delete buttons in admin tables
      document.getElementById('adminStudentTable').addEventListener('click', (e) => {
        if (e.target.closest('.edit-btn')) {
          const btn = e.target.closest('.edit-btn');
          openAdminModal(btn.dataset.type, 'edit', btn.dataset.id);
        } else if (e.target.closest('.delete-btn')) {
          const btn = e.target.closest('.delete-btn');
          deleteUser(btn.dataset.type, btn.dataset.id);
        }
      });
      document.getElementById('adminTeacherTable').addEventListener('click', (e) => {
        if (e.target.closest('.edit-btn')) {
          const btn = e.target.closest('.edit-btn');
          openAdminModal(btn.dataset.type, 'edit', btn.dataset.id);
        } else if (e.target.closest('.delete-btn')) {
          const btn = e.target.closest('.delete-btn');
          deleteUser(btn.dataset.type, btn.dataset.id);
        }
      });
    });
  </script>
 </body>
 // Handle "Forgot Password?" button click
document.getElementById('forgotPasswordBtn').addEventListener('click', () => {
  const email = prompt('Please enter your registered email address:');
  if (!email) return;
  const role = document.getElementById('loginRole').value;
  let users = [];
  if (role === 'student') users = readData(STORAGE_KEYS.students);
  else if (role === 'teacher') users = readData(STORAGE_KEYS.teachers);
  else if (role === 'administrator') users = readData(STORAGE_KEYS.admins);
  else {
    alert('Invalid role.');
    return;
  }
  const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());
  if (user) {
    alert(`Your password is: ${user.password}`);
  } else {
    alert('Email not found. Please check and try again.');
  }
});
</html>
